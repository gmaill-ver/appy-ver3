<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学習トラッカー - 資格試験対策</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f5f7;
            color: #333;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            padding-bottom: 60px;
        }

        .header {
            background: linear-gradient(135deg, #2c5282 0%, #2d3748 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .lock-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
        }

        .countdown {
            font-size: 18px;
            opacity: 0.9;
        }

        .tab-container {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .tabs {
            display: flex;
            justify-content: space-around;
            padding: 0;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: transparent;
            color: #64748b;
            font-size: 16px;
            transition: all 0.3s;
            position: relative;
        }

        .tab.active {
            color: #2563eb;
            font-weight: 600;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: #2563eb;
        }

        .content {
            padding: 20px;
            display: none;
        }

        .content.active {
            display: block;
        }

        /* 記録入力タブ */
        .subject-cards {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .subject-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .subject-header {
            padding: 15px;
            background: #f8fafc;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border-bottom: 1px solid #e2e8f0;
        }

        .subject-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: #1e293b;
        }

        .pin-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
            color: #64748b;
            transition: color 0.3s;
        }

        .pin-button.pinned {
            color: #f59e0b;
        }

        .subject-body {
            display: none;
        }

        .subject-body.expanded {
            display: block;
            padding: 15px;
        }

        .study-section {
            margin-top: 15px;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-weight: 600;
            color: #475569;
        }

        .hierarchy-item {
            padding: 10px;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .hierarchy-item:hover {
            background: #e2e8f0;
        }

        .hierarchy-content {
            display: none;
            margin-top: 10px;
            padding: 15px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }

        .hierarchy-content.expanded {
            display: block;
        }

        /* 問題ヒートマップ */
        .heatmap-container {
            margin-top: 20px;
        }

        .questions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 8px;
            margin-bottom: 15px;
        }

        .question-box {
            padding: 12px 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            min-height: 60px;
        }

        .question-box:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .question-box.correct {
            background: #22c55e;
        }

        .question-box.incorrect {
            background: #ef4444;
        }

        .question-box.bookmarked {
            background: #fbbf24;
        }

        .question-box.pending {
            background: #e2e8f0;
            color: #64748b;
        }

        .question-number {
            font-size: 18px;
            margin-bottom: 4px;
        }

        /* 要点確認ボタン */
        .point-check-button {
            padding: 3px 6px;
            background: rgba(255,255,255,0.9);
            color: #1e293b;
            border: none;
            border-radius: 4px;
            font-size: 10px;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 4px;
        }

        .point-check-button:hover {
            background: white;
        }

        .point-display {
            display: none;
            margin-top: 10px;
            padding: 12px;
            background: #f0f9ff;
            border: 1px solid #bfdbfe;
            border-radius: 6px;
            font-size: 14px;
            line-height: 1.6;
        }

        .point-display.show {
            display: block;
        }

        .point-display h4 {
            color: #1e40af;
            margin-bottom: 8px;
            font-size: 14px;
        }

        /* 分析タブ - 改善版 */
        .analysis-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            width: 100%;
        }

        .analysis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .analysis-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
        }

        .analysis-pin {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            color: #cbd5e1;
            padding: 4px;
            transition: color 0.3s;
        }

        .analysis-pin:hover {
            color: #94a3b8;
        }

        .analysis-pin.pinned {
            color: #f59e0b;
        }

        /* 進捗タブ */
        .progress-overview {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
        }

        .progress-title {
            font-size: 20px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .progress-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
        }

        /* 底部导航 */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 5px;
            cursor: pointer;
            color: #64748b;
            font-size: 12px;
            transition: color 0.3s;
        }

        .nav-item.active {
            color: #3b82f6;
        }

        .nav-icon {
            font-size: 20px;
        }

        /* CSVインポート */
        .csv-import {
            background: #f8fafc;
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-top: 20px;
        }

        .csv-import input[type="file"] {
            display: none;
        }

        .csv-import-label {
            display: inline-block;
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .csv-import-label:hover {
            background: #2563eb;
        }

        /* モーダル */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 16px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #1e293b;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #475569;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-button {
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s;
        }

        .form-button:hover {
            background: #2563eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <span class="lock-icon">🔒</span>
                <span>学習トラッカー</span>
            </h1>
            <div class="countdown">試験日まで 84 日</div>
        </div>

        <div class="tab-container">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('record')">記録入力</button>
                <button class="tab" onclick="switchTab('analysis')">分析</button>
                <button class="tab" onclick="switchTab('progress')">進捗</button>
            </div>
        </div>

        <!-- 記録入力タブ -->
        <div id="record" class="content active">
            <div class="subject-cards">
                <div class="subject-card" data-subject="gouhou">
                    <div class="subject-header" onclick="toggleSubject('gouhou')">
                        <div class="subject-title">
                            <span>📚</span>
                            <span>合格革命 肢別過去問集 2024年版</span>
                        </div>
                        <button class="pin-button" onclick="togglePin(event, 'gouhou')">📌</button>
                    </div>
                    <div class="subject-body" id="gouhou-body">
                        <div class="study-section">
                            <div class="section-header">
                                <span>📂</span>
                                <span>民法</span>
                            </div>
                            <div class="hierarchy-item" onclick="toggleHierarchy('minpou-sousoku')">
                                <span>▶ 総則</span>
                            </div>
                            <div id="minpou-sousoku" class="hierarchy-content">
                                <div class="heatmap-container">
                                    <div class="questions-grid">
                                        <div class="question-box correct" data-question="1">
                                            <div class="question-number">1</div>
                                            <button class="point-check-button" onclick="togglePoint(event, 'minpou-1')">要点確認</button>
                                        </div>
                                        <div class="question-box correct" data-question="2">
                                            <div class="question-number">2</div>
                                            <button class="point-check-button" onclick="togglePoint(event, 'minpou-2')">要点確認</button>
                                        </div>
                                        <div class="question-box incorrect" data-question="3">
                                            <div class="question-number">3</div>
                                            <button class="point-check-button" onclick="togglePoint(event, 'minpou-3')">要点確認</button>
                                        </div>
                                        <div class="question-box pending" data-question="4">
                                            <div class="question-number">4</div>
                                        </div>
                                        <div class="question-box incorrect" data-question="5">
                                            <div class="question-number">5</div>
                                            <button class="point-check-button" onclick="togglePoint(event, 'minpou-5')">要点確認</button>
                                        </div>
                                        <div class="question-box correct" data-question="6">
                                            <div class="question-number">6</div>
                                        </div>
                                        <div class="question-box incorrect" data-question="7">
                                            <div class="question-number">7</div>
                                        </div>
                                        <div class="question-box incorrect" data-question="8">
                                            <div class="question-number">8</div>
                                            <button class="point-check-button" onclick="togglePoint(event, 'minpou-8')">要点確認</button>
                                        </div>
                                    </div>
                                    
                                    <div id="minpou-1" class="point-display">
                                        <h4>📖 要点確認 - 問題1</h4>
                                        <p>民法総則における意思表示の基本原則について、虚偽表示は無効となる（民法94条）</p>
                                    </div>
                                    <div id="minpou-2" class="point-display">
                                        <h4>📖 要点確認 - 問題2</h4>
                                        <p>法人の能力について、権利能力は定款に定められた目的の範囲内で認められる</p>
                                    </div>
                                    <div id="minpou-3" class="point-display">
                                        <h4>📖 要点確認 - 問題3</h4>
                                        <p>代理人の権限について、表見代理が成立する3つのパターンを理解する必要がある</p>
                                    </div>
                                    <div id="minpou-5" class="point-display">
                                        <h4>📖 要点確認 - 問題5</h4>
                                        <p>時効の中断事由：請求、差押え、承認の3つを覚える</p>
                                    </div>
                                    <div id="minpou-8" class="point-display">
                                        <h4>📖 要点確認 - 問題8</h4>
                                        <p>条件と期限の違い：条件は成就が不確実、期限は到来が確実</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="hierarchy-item" onclick="toggleHierarchy('minpou-bukken')">
                                <span>▶ 物権</span>
                            </div>
                            <div id="minpou-bukken" class="hierarchy-content">
                                <div class="heatmap-container">
                                    <div class="questions-grid">
                                        <!-- 物権の問題 -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="study-section">
                            <div class="section-header">
                                <span>📂</span>
                                <span>行政法</span>
                            </div>
                            <div class="hierarchy-item" onclick="toggleHierarchy('gyousei-sousoku')">
                                <span>▶ 総則</span>
                            </div>
                            <div id="gyousei-sousoku" class="hierarchy-content">
                                <div class="heatmap-container">
                                    <div class="questions-grid">
                                        <!-- 行政法の問題 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="subject-card" data-subject="gyosei">
                    <div class="subject-header" onclick="toggleSubject('gyosei')">
                        <div class="subject-title">
                            <span>📖</span>
                            <span>行政書士試験 過去問集</span>
                        </div>
                        <button class="pin-button" onclick="togglePin(event, 'gyosei')">📌</button>
                    </div>
                    <div class="subject-body" id="gyosei-body">
                        <!-- 行政書士試験の内容 -->
                    </div>
                </div>
            </div>

            <div class="csv-import">
                <p style="margin-bottom: 10px; color: #64748b;">要点データをCSVで一括インポート</p>
                <label for="csv-file" class="csv-import-label">
                    CSVファイルを選択
                </label>
                <input type="file" id="csv-file" accept=".csv" onchange="importCSV(event)">
            </div>
        </div>

        <!-- 分析タブ -->
        <div id="analysis" class="content">
            <div class="analysis-card">
                <div class="analysis-header">
                    <div class="analysis-title">
                        <span>📊</span>
                        <span>学習グラフ</span>
                    </div>
                    <button class="analysis-pin" onclick="toggleAnalysisPin(this)">📌</button>
                </div>
                <canvas id="studyChart" style="max-height: 300px;"></canvas>
            </div>

            <div class="analysis-card">
                <div class="analysis-header">
                    <div class="analysis-title">
                        <span>📈</span>
                        <span>学習履歴</span>
                    </div>
                    <button class="analysis-pin" onclick="toggleAnalysisPin(this)">📌</button>
                </div>
                <div class="progress-stats">
                    <div class="stat-item" style="background: #f0f9ff;">
                        <div class="stat-label">今週の学習時間</div>
                        <div class="stat-value" style="color: #3b82f6;">12.5時間</div>
                    </div>
                    <div class="stat-item" style="background: #f0fdf4;">
                        <div class="stat-label">正答率</div>
                        <div class="stat-value" style="color: #22c55e;">78%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 進捗タブ -->
        <div id="progress" class="content">
            <div class="progress-overview">
                <div class="progress-title">📊 学習進捗サマリー</div>
                <div class="progress-stats">
                    <div class="stat-item">
                        <div class="stat-label">総問題数</div>
                        <div class="stat-value">1,250</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">完了済み</div>
                        <div class="stat-value">856</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">正答率</div>
                        <div class="stat-value">78.5%</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">残り日数</div>
                        <div class="stat-value">84日</div>
                    </div>
                </div>
            </div>

            <div class="analysis-card">
                <div class="analysis-title">
                    <span>📚</span>
                    <span>科目別進捗</span>
                </div>
                <div style="margin-top: 15px;">
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>民法</span>
                            <span style="color: #3b82f6; font-weight: bold;">85%</span>
                        </div>
                        <div style="height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden;">
                            <div style="width: 85%; height: 100%; background: linear-gradient(90deg, #3b82f6, #60a5fa);"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>行政法</span>
                            <span style="color: #22c55e; font-weight: bold;">72%</span>
                        </div>
                        <div style="height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden;">
                            <div style="width: 72%; height: 100%; background: linear-gradient(90deg, #22c55e, #4ade80);"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>憲法</span>
                            <span style="color: #f59e0b; font-weight: bold;">58%</span>
                        </div>
                        <div style="height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden;">
                            <div style="width: 58%; height: 100%; background: linear-gradient(90deg, #f59e0b, #fbbf24);"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 底部導航 -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="switchTab('record')">
                <span class="nav-icon">📝</span>
                <span>登録</span>
            </div>
            <div class="nav-item">
                <span class="nav-icon">❓</span>
                <span>一問一答</span>
            </div>
            <div class="nav-item">
                <span class="nav-icon">📚</span>
                <span>要点確認</span>
            </div>
            <div class="nav-item">
                <span class="nav-icon">🏆</span>
                <span>実績</span>
            </div>
            <div class="nav-item">
                <span class="nav-icon">⚙️</span>
                <span>設定</span>
            </div>
        </div>
    </div>

    <!-- 要点登録モーダル -->
    <div id="pointModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">要点を登録</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">問題番号（ID）</label>
                <input type="text" class="form-input" id="pointQuestionId" placeholder="例: minpou-1">
            </div>
            <div class="form-group">
                <label class="form-label">要点内容</label>
                <textarea class="form-textarea" id="pointContent" placeholder="要点を入力してください"></textarea>
            </div>
            <button class="form-button" onclick="savePoint()">保存</button>
        </div>
    </div>

    <script>
        // データストレージ
        let studyData = {
            subjects: {},
            points: {
                'minpou-1': '民法総則における意思表示の基本原則について、虚偽表示は無効となる（民法94条）',
                'minpou-2': '法人の能力について、権利能力は定款に定められた目的の範囲内で認められる',
                'minpou-3': '代理人の権限について、表見代理が成立する3つのパターンを理解する必要がある',
                'minpou-5': '時効の中断事由：請求、差押え、承認の3つを覚える',
                'minpou-8': '条件と期限の違い：条件は成就が不確実、期限は到来が確実'
            },
            pinnedItems: []
        };

        // タブ切り替え
        function switchTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.content');
            const navItems = document.querySelectorAll('.nav-item');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            navItems.forEach(item => item.classList.remove('active'));
            
            // タブをアクティブにする
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // 対応するナビゲーションもアクティブにする
            if (tabName === 'record') {
                navItems[0].classList.add('active');
            }
        }

        // 教材の展開/折りたたみ（改善版）
        function toggleSubject(subjectId) {
            const body = document.getElementById(subjectId + '-body');
            const allBodies = document.querySelectorAll('.subject-body');
            
            // 他の教材を閉じる
            allBodies.forEach(otherBody => {
                if (otherBody.id !== subjectId + '-body') {
                    otherBody.classList.remove('expanded');
                }
            });
            
            // 選択した教材をトグル
            body.classList.toggle('expanded');
        }

        // 階層の展開/折りたたみ
        function toggleHierarchy(hierarchyId) {
            const content = document.getElementById(hierarchyId);
            const item = content.previousElementSibling;
            const arrow = item.querySelector('span');
            
            content.classList.toggle('expanded');
            
            if (content.classList.contains('expanded')) {
                arrow.textContent = arrow.textContent.replace('▶', '▼');
            } else {
                arrow.textContent = arrow.textContent.replace('▼', '▶');
            }
        }

        // ピン留め機能
        function togglePin(event, subjectId) {
            event.stopPropagation();
            const button = event.target;
            button.classList.toggle('pinned');
            
            if (button.classList.contains('pinned')) {
                studyData.pinnedItems.push(subjectId);
            } else {
                const index = studyData.pinnedItems.indexOf(subjectId);
                if (index > -1) {
                    studyData.pinnedItems.splice(index, 1);
                }
            }
            
            saveData();
        }

        // 分析タブのピン留め
        function toggleAnalysisPin(button) {
            button.classList.toggle('pinned');
            saveData();
        }

        // 要点確認の表示/非表示
        function togglePoint(event, pointId) {
            event.stopPropagation();
            const pointDisplay = document.getElementById(pointId);
            const allPointDisplays = document.querySelectorAll('.point-display');
            
            // 他の要点を閉じる
            allPointDisplays.forEach(display => {
                if (display.id !== pointId) {
                    display.classList.remove('show');
                }
            });
            
            // 選択した要点をトグル
            pointDisplay.classList.toggle('show');
        }

        // モーダルを閉じる
        function closeModal() {
            document.getElementById('pointModal').classList.remove('active');
        }

        // 要点を保存
        function savePoint() {
            const questionId = document.getElementById('pointQuestionId').value;
            const content = document.getElementById('pointContent').value;
            
            if (questionId && content) {
                studyData.points[questionId] = content;
                
                // 既存の要点表示を更新
                const existingDisplay = document.getElementById(questionId);
                if (existingDisplay) {
                    existingDisplay.innerHTML = `
                        <h4>📖 要点確認 - ${questionId}</h4>
                        <p>${content}</p>
                    `;
                }
                
                saveData();
                closeModal();
                
                // フォームをクリア
                document.getElementById('pointQuestionId').value = '';
                document.getElementById('pointContent').value = '';
                
                alert('要点を保存しました');
            } else {
                alert('問題番号と要点内容を入力してください');
            }
        }

        // CSVインポート機能
        function importCSV(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const csv = e.target.result;
                const lines = csv.split('\n');
                
                // ヘッダー行をスキップ
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (line) {
                        const [questionId, content] = line.split(',');
                        if (questionId && content) {
                            studyData.points[questionId.trim()] = content.trim();
                        }
                    }
                }
                
                saveData();
                alert('CSVファイルから要点をインポートしました');
                updatePointDisplays();
            };
            
            reader.readAsText(file);
        }

        // 要点表示を更新
        function updatePointDisplays() {
            for (const [questionId, content] of Object.entries(studyData.points)) {
                const existingDisplay = document.getElementById(questionId);
                if (existingDisplay) {
                    existingDisplay.innerHTML = `
                        <h4>📖 要点確認 - ${questionId}</h4>
                        <p>${content}</p>
                    `;
                }
            }
        }

        // データ保存
        function saveData() {
            localStorage.setItem('studyData', JSON.stringify(studyData));
        }

        // データ読み込み
        function loadData() {
            const saved = localStorage.getItem('studyData');
            if (saved) {
                studyData = JSON.parse(saved);
                updatePointDisplays();
            }
        }

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });
    </script>
</body>
</html>
